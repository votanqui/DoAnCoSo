@model DoAn_21806064393.Models.acc

@{
    ViewBag.Title = "DetailsACC";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    bool isLoggedIn = Session["LoggedInUser"] != null;
}


<style>
    .custom-container {
        background-color: rgba(0, 0, 0, 0.5); /* Màu đen với độ trong suốt 50% */
        padding: 30px; /* Để tránh việc nội dung bị ẩn bởi background */
        margin-top: 15px;
    }

    .row {
        display: flex;
    }

    .details-item {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 5px;
        color: white;
    }

    .details_thongtin {
        display: flex;
    }
</style>
<div class="container custom-container">
    <div class="details_thongtin">
        <div class="details-row">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#paymentModal">
                Thanh toán
            </button>
            <button type="button" class="btn btn-success addToCartBtn" id="addToCartBtn">Thêm vào giỏ hàng</button>

            <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="paymentModalLabel">Xác nhận thanh toán #@Html.DisplayFor(model => model.id_acc)</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <p>Số tiền đang có: @Session["UserPrice"]</p>
                            <p>Giá mua TK: @Html.DisplayFor(model => model.giasaukhuyenmai)</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                            <button type="button" class="btn btn-primary" id="confirmPayment">Thanh toán</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="registerSuccessDiv" class="modal fade" tabindex="-1" aria-labelledby="registerSuccessDivLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="registerSuccessDivLabel">Chúc Mừng Bạn Đã Mua Thành Công Tài Khoản#@Html.DisplayFor(model => model.id_acc) </h5>
                            <p>Bạn Vui Lòng Liên Hệ Admin Để Đổi Thông Tin Nhé!</p>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Username: @Html.DisplayFor(model => model.account)<span id="username"></span></p>
                            <p>Password: @Html.DisplayFor(model => model.password)<span id="password"></span></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="details-row">
    <div class="col-md-12 details-item">
        <strong>So Tuong:</strong> @Html.DisplayFor(model => model.so_tuong)
    </div>

</div>
<div class="details-row">
    <div class="col-md-12 details-item">
        <strong>So Skin:</strong> @Html.DisplayFor(model => model.so_skin)
    </div>
</div>
<div class="details-row">
    <div class="col-md-12 details-item">
        <strong>So Mau Mat:</strong> @Html.DisplayFor(model => model.so_mau_mat)
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        $("#showPaymentDiv").click(function(){
            // Lấy giá trị số tiền từ session hoặc model và gán cho các phần tử tương ứng
            var userPrice = "@Session["UserPrice"]";
            var accPrice = "@Html.DisplayFor(model => model.gia)";
            $("#userPrice").text(userPrice);
            $("#accPrice").text(accPrice);
            // Hiển thị div
            $("#paymentDiv").show();
        });

        $("#cancelPayment").click(function(){
            // Ẩn div khi bấm nút thoát
            $("#paymentDiv").hide();
        });

       $("#confirmPayment").click(function(){
    var isLoggedIn = @(Session["LoggedInUser"] != null ? "true" : "false");
    if (!isLoggedIn) {
        alert("Vui lòng đăng nhập để thực hiện thanh toán.");
        window.location.href = "/User/Login"; 
        return;
    }
    var userPrice = parseFloat("@Session["UserPrice"]");
    var accountPrice = parseFloat("@Model.giasaukhuyenmai");
    var accountId = @Model.id_acc;
    if (userPrice >= accountPrice) {
        var newPrice = userPrice - accountPrice;
        $.ajax({
            url: '/ThanhToan/UpdateUserPrice',
            type: 'POST',
            data: {
                newUserPrice: newPrice,
                accountId: accountId
            },
            success: function (response) {
                if (response.success) {
                    $("#username");
                    $("#password");
                    $("#registerSuccessDiv").modal("show");
                    alert("Thanh toán thành công.");
                    setTimeout(function () {
                        $("#paymentModal").modal("hide");
                    }, 2000);

                } else {
                    alert(response.error);
                }
            },
            error: function () {
                alert("Đã xảy ra lỗi khi gửi yêu cầu đến server.");
            }
        });
    } else {
        alert("Số tiền trong tài khoản không đủ để thanh toán.");
    }
});
 $("#addToCartBtn").click(function () {
     var accountId = @Model.id_acc;
     $.ajax({
         url: '/User/ThemGioHang',
         type: 'POST',
         data: { accountId: accountId },
         success: function (response) {
             if (response.success) {
                 alert("Đã thêm vào giỏ hàng!");

             } else {
                 alert("Đã xảy ra lỗi: " + response.error);
             }
         },
         error: function () {
             alert("Đã xảy ra lỗi khi gửi yêu cầu đến server.");
         }
     });
 });

    });



</script>
